<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>用户登录</title>
    <th:block th:include="portal/common/include :: header('用户登录')"/>
    <!--    引入自定义css-->
    <link rel="stylesheet" th:href="@{/component/portal/css/login.css}" media="all"/>
</head>
<body>
<!-- 粒子背景 -->
<div id="particles-js"></div>
<!-- 登录表单 -->
<form class="layui-form login-form layui-panel" autocomplete="off" action="">
    <h1 class="login-title">
        <img style="height: 30px;" th:src="@{/component/portal/image/logo.png}" alt="logo"/>
        <span>用户登录</span>
    </h1>
    <!-- 用户名 -->
    <div class="layui-form-item">
        <i class="layui-icon layui-icon-username"></i>
        <input type="text" name="loginName" placeholder="请输入用户名" class="layui-input" lay-verify="required"
               lay-reqText="请输入用户名"/>
    </div>
    <!-- 密码 -->
    <div class="layui-form-item">
        <i class="layui-icon layui-icon-password"></i>
        <input type="password" name="password" placeholder="请输入密码" class="layui-input" lay-verify="required"
               lay-reqText="请输入密码"/>
    </div>
    <!-- 验证码 -->
    <div class="layui-form-item">
        <i class="layui-icon layui-icon-vercode"></i>
        <input type="text" name="captcha" placeholder="请输入验证码" class="layui-input" lay-verify="required"
               lay-reqText="请输入验证码"/>
        <a href="javascript:void(0);" title="点击更换验证码">
            <img th:src="@{/captcha/generate}" class="imgcode"
                 style="width: 110px;height: 38px"/>
        </a>
    </div>
    <div class="layui-form-item" style="display: flex;justify-content: center">
        <button class="layui-btn layui-btn-normal" id="login" type="button" lay-submit lay-filter="login"> 登录</button>
        <a th:href="@{/portal/register}" class="layui-btn layui-btn-normal">注册</a>
    </div>
</form>

<script th:src="@{/component/layui/layui.js}"></script>
<script th:src="@{/component/yueqian/yueqian.js}"></script>
<script th:src="@{/component/portal/js/jquery.min.js}"></script>
<!-- Jqarticle Js -->
<script th:src="@{/component/portal/js/particles.js}"></script>

<script>
    if(window!=top){ top.location.href = location.href; }
    layui.use(['element', 'form', 'table', 'jquery', 'common', 'layerCustom'], function () {
        var element = layui.element,
            table = layui.table,
            $ = layui.jquery,
            layerCustom = layui.layerCustom,
            common = layui.common,
            form = layui.form;

        //监听提交
        form.on('submit(login)', function (data) {
            $(this).text("登录中...").attr("disabled", "disabled").addClass("layui-disabled");
            var url = "/portal/login";

            common.ajax.post(url, data.field, function (result) {
                if (result.success) {
                    layerCustom.greenLaughMsg("登录成功！", function () {
                        window.location.href = '/portal/index';
                    })
                } else {
                    $("#login").text("登录").removeAttr("disabled").removeClass("layui-disabled");
                    var url = "/captcha/generate?s=" + Math.random();
                    $(".imgcode").attr("src", url);
                    layerCustom.redCryMsg(result.msg);
                }
            });

            return false;
        });

        //按下回车登录
        $("body").on("keyup", (e) => {
            if (e.which === 13) {
                $("#login").trigger("click");
            }
        });

        //验证码切换
        $('.imgcode').click(function () {
            var url = "/captcha/generate?s=" + Math.random();
            $(".imgcode").attr("src", url);
        });
    });
</script>
</body>
</html>